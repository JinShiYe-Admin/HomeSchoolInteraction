<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../../css/mui.min.css">
		<style>
			body,
			.mui-content {
				background-color: #333;
				color: #fff;
			}
			
			header.mui-bar {
				display: none;
			}
			
			.mui-bar-nav~.mui-content {
				padding: 0;
			}
			
			.title {
				margin: 35px 15px 10px;
			}
			
			.title+.content {
				margin: 10px 15px 35px;
				color: #bbb;
				text-indent: 1em;
				font-size: 14px;
				line-height: 24px;
			}
			
			.mui-table-view {
				margin-bottom: 35px;
			}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<div class="title">校讯通</div>
			<div class="content">
				<p style="margin: 10px 15px;">
					<button id="close-btn" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px;">退出登录</button>
				</p>

			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/publicProtocolNew.js"></script>
		<script src="../../js/storageKeyName.js"></script>
		<script src="../../js/utils/store.js"></script>
		<script src="../../js/utils/utils.js"></script>
		<script type="text/javascript" charset="utf-8">
			//关闭back、menu按键监听，这样侧滑主界面会自动获得back和memu的按键事件，仅在主界面处理按键逻辑即可；
			mui.init({
				keyEventBind: {
					backbutton: false,
					menubutton: false
				}
			});
			var main = null;
			mui.plusReady(function() {
				main = plus.webview.currentWebview().opener();
			})

			function closeMenu() {
				//				mui.fire(plus.webview.currentWebview().opener(), 'closeMinePage', {});
				//				store.remove(window.storageKeyName.PERSONALINFO);
				//				utils.mOpenWithData("../../html/login/loginIndex.html", {});

				//获取个人信息
				var personal = store.get(window.storageKeyName.PERSONALINFO);
				//解绑个推
				var info = plus.push.getClientInfo();
				var tempBindData = {
					appId: info.appid,
					alias: personal.utid,
					cid: info.clientid
				}
				unbindPro(tempBindData, function function_name(data) {
					if(data.RspCode == 0) {} else {}
				});
				//设置app角标,flag=0直接设置角标数字，flag=1角标减1,falg=2角标加1
				utils.setBadgeNumber(0,0);

				//获取所有已打开的webview 实例————重新打开login.html————循环关闭页面
				store.remove(window.storageKeyName.PERSONALINFO);
//				plus.webview.open('../../html/login/loginIndex.html');
				plus.webview.open('../../html/login/firstPage.html');
				var curr = plus.webview.currentWebview();
				var wvs = plus.webview.all();
				for(var i = 0, len = wvs.length; i < len; i++) {
					//关闭除login页面外的其他页面
					if(wvs[i].getURL().indexOf('firstPage.html') != -1) {
//					if(wvs[i].getURL().indexOf('loginIndex.html') != -1) {
						continue;
					}
					plus.webview.close(wvs[i]);
				}
				curr.close();
			}

			//左滑显示出来的菜单，只需监听右滑，然后将菜单关闭即可；在该菜单上左滑，不做任何操作；
			window.addEventListener("swiperight", closeMenu);

			document.getElementById("close-btn").addEventListener('tap', closeMenu);
		</script>
	</body>

</html>